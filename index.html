<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XRi - Selezione Mondo</title>
    <script src="https://xri.onl/XRi.js"></script>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        #ui-layer { position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .carousel { display: flex; align-items: center; gap: 50px; }
        .arrow { font-size: 8rem; color: #00d1ff; cursor: pointer; user-select: none; }
        .map-name { font-size: 3rem; font-weight: bold; text-shadow: 0 0 15px #00d1ff; }
        .btn-enter { margin-top: 30px; padding: 20px 60px; font-size: 2rem; background: #00d1ff; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; }
        
        #debug-overlay { 
            position:fixed; top:0; left:0; width:100%; height:100%; 
            background:rgba(0,0,0,0.8); z-index:9999; padding:20px; box-sizing: border-box;
            border: 5px solid #ff4444; overflow-y: auto; font-family: monospace; font-size: 1.5rem;
        }
        .close-debug { position: absolute; top: 10px; right: 10px; padding: 10px 20px; background: red; color: white; border: none; }
    </style>
</head>
<body>

    <div id="debug-overlay">
        <button class="close-debug" onclick="this.parentElement.style.display='none'">CHIUDI DEBUG</button>
        <div id="debug-content" style="margin-top: 60px;"></div>
    </div>

    <div id="ui-layer">
        <h1>SCEGLI IL TUO MONDO</h1>
        
        <div class="carousel">
            <div class="arrow" onclick="changeMap(-1)">&#10094;</div>
            <div class="map-name" id="map-label">PALUDE</div>
            <div class="arrow" onclick="changeMap(1)">&#10095;</div>
        </div>

        <button class="btn-enter" onclick="launchGame()">ENTRA NEL MONDO</button>
        <button style="margin-top:20px; background:none; border:1px solid #444; color:white; padding:10px; width:10%;" onclick="location.reload()">RELOAD SYSTEM</button>
    </div>

    <script>
        const maps = [
            { id: 'swamp', name: 'PALUDE', glb: 'https://raw.githubusercontent.com/simonevetere/XRi-game-example/main/assets/3d/maps/swamp_location.glb' },
            { id: 'sand', name: 'DESERTO', glb: 'https://raw.githubusercontent.com/simonevetere/XRi-game-example/main/assets/3d/maps/sands_location.glb' },
            { id: 'crypt', name: 'CRIPTA', glb: 'https://raw.githubusercontent.com/simonevetere/XRi-game-example/main/assets/3d/maps/crypt_location.glb' }
        ];

        let currentIndex = 0;
        let currentMap = null;

        async function updateMapAR() {
            const data = maps[currentIndex];
            document.getElementById('map-label').innerText = "CARICAMENTO...";

            if (window.XRi) {
                XRi.clearAll();
                
                currentMap = await XRi.spawn("map", data.glb, 0.4, {x:-0.5, y:0, z:0.5}, {x:0, y:180, z:0});
                
                document.getElementById('map-label').innerText = data.name;
                currentMap.setGrabbable(false);
            }
        }

        function changeMap(dir) {
            currentIndex = (currentIndex + dir + maps.length) % maps.length;
            updateMapAR();
        }

        function launchGame() {
            window.location.href = `personaggi.html?map=${encodeURIComponent(maps[currentIndex].glb)}`;
        }

        // Partenza
        window.onload = () => {
            if (window.vuplex) updateMapAR();
            else window.addEventListener('vuplexready', updateMapAR);
        };
    </script>
</body>
</html>